<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./style.css" />
    <script src="./index.js" defer></script>
  </head>
  <body>
    <div class="container">
      <div class="calculator">
        <div class="result"><p>10</p></div>
        <div class="buttonGrid">
          <div class="button operator" type="operator">&#247;</div>
          <div class="button operator" type="operator">&#215;</div>
          <div class="button operator" type="operator">&#8722;</div>
          <div class="button operator" type="operator">&#43;</div>
          <div class="button" type="number">1</div>
          <div class="button" type="number">2</div>
          <div class="button" type="number">3</div>
          <div class="button operator" type="equals">=</div>
          <div class="button" type="number">4</div>
          <div class="button" type="number">5</div>
          <div class="button" type="number">6</div>
          <div class="button" type="number">7</div>
          <div class="button" type="number">8</div>
          <div class="button" type="number">9</div>
          <div class="button" type="number">0</div>
          <div class="button" type="decimal">.</div>
          <div class="button operator" type="clear">C</div>
        </div>
      </div>
    </div>
    <script>
      class Calculator {
        displayValue = "0";
        firstOperand = null;
        waitingForSecondOperand = false;
        operator = null;

        constructor() {
          this.updateDisplay();
        }

        updateDisplay() {
          const display = document.querySelector(".result p");
          display.textContent = this.displayValue;
        }

        inputDigit(digit) {
          if (this.waitingForSecondOperand === true) {
            this.displayValue = digit;
            this.waitingForSecondOperand = false;
          } else {
            this.displayValue =
              this.displayValue === "0" ? digit : this.displayValue + digit;
          }
        }

        inputDecimal(dot) {
          if (this.waitingForSecondOperand === true) return;
          if (!this.displayValue.includes(dot)) {
            this.displayValue += dot;
          }
        }

        performCalculation = {
          "÷": (firstOperand, secondOperand) => firstOperand / secondOperand,

          "×": (firstOperand, secondOperand) => firstOperand * secondOperand,

          "+": (firstOperand, secondOperand) => firstOperand + secondOperand,

          "−": (firstOperand, secondOperand) => firstOperand - secondOperand,

          "=": (firstOperand, secondOperand) => secondOperand,
        };

        handleOperator(nextOperator) {
          const inputValue = parseFloat(this.displayValue);

          if (this.operator && this.waitingForSecondOperand) {
            this.operator = nextOperator;
            return;
          }

          if (this.firstOperand == null) {
            this.firstOperand = inputValue;
          } else if (this.operator) {
            const result = this.performCalculation[this.operator](
              this.firstOperand,
              inputValue
            );

            this.displayValue = String(result);
            this.firstOperand = result;
          }

          this.waitingForSecondOperand = true;
          this.operator = nextOperator;
        }

        reset() {
          this.displayValue = "0";
          this.firstOperand = null;
          this.waitingForSecondOperand = false;
          this.operator = null;
        }

        keyDown(type, value) {
          switch (type) {
            case "number":
              this.inputDigit(value);
              this.updateDisplay();
              break;

            case "decimal":
              this.inputDecimal(value);
              this.updateDisplay();
              break;

            case "clear":
              this.reset();
              this.updateDisplay();
              break;

            case "operator":
            case "equals":
              this.handleOperator(value);
              this.updateDisplay();
              break;

            default:
              break;
          }
        }
      }

      let calculator = new Calculator();

      document.querySelectorAll(".button").forEach((button) => {
        button.addEventListener("click", () => {
          calculator.keyDown(button.getAttribute("type"), button.textContent);
        });
        button.addEventListener("touchstart", () => {
          calculator.keyDown(button.getAttribute("type"), button.textContent);
        });
      });
    </script>
  </body>
</html>
